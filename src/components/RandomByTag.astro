// src/components/RandomByTag.tsx
import { useState } from 'preact/hooks';

type Post = {
  slug: string;
  title: string;
  description: string;
  tags: string[];
};

type Props = {
  posts: Post[];
  tags: string[];
};

export default function RandomByTag({ posts, tags }: Props) {
  const [selectedPost, setSelectedPost] = useState<Post | null>(null);

  const handleClick = (tag: string) => {
    const filtered = posts.filter((p) => p.tags?.includes(tag));
    if (filtered.length === 0) {
      setSelectedPost(null);
      return;
    }
    const pick = filtered[Math.floor(Math.random() * filtered.length)];
    setSelectedPost(pick);
  };

  return (
    <section class="random-by-tag">
      <h2>Hôm nay bạn muốn đọc gì?</h2>
      <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
        {tags.map((tag) => (
          <button onClick={() => handleClick(tag)} class="tag-button">
            {tag}
          </button>
        ))}
      </div>
      <div style={{ marginTop: '1rem' }}>
        {selectedPost ? (
          <>
            <h3>
              <a href={`/blog/${selectedPost.slug}`}>{selectedPost.title}</a>
            </h3>
            <p>{selectedPost.description}</p>
            <a href={`/blog/${selectedPost.slug}`} class="button">Đọc ngay</a>
          </>
        ) : (
          <p>Chọn thể loại để bắt đầu...</p>
        )}
      </div>
    </section>
  );
}
